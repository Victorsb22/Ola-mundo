<html>
<script>

	class Lancamento {

		constructor(categoria, tipo, valor) {
			if (tipo !== "receita" && tipo !== "despesa") {
				throw new Error("Lançamento Inválido: Tipo deve ser receita ou despesa")
			}
			if (valor <= 0) {
				throw new Error("Lançamento Inválido: Valor deve ser maior que zero")
			}
			if (categoria === "") {
				throw new Error("Lançamento Inválido: A Categoria é obrigatória")
			}
			this.categoria = categoria
			this.tipo = tipo
			this.valor = valor
		}
	}
	class Mes {
		constructor(nome, saldoInicial) {
			if (nome === "") throw new error("Mês inválido o  nome é obrigatório");
			this.nome = nome;
			this.saldoInicial = saldoInicial;
			this.totalizadorDoMes = { saldo: 0, saldoInicial, juros: 0, rendimentos: 0, receitas: 0, despesas: 0, distribuicaoDeDespesas: [] };
			this.lancamentos = [];
		}

		adicionarLancamento(lancamento) {
			this.lancamentos.push(lancamento);
		}

		calcularSaldo(mes, saldoInicial, lancamentos) {
			this.totalizadorDoMes.saldo = this.saldoInicial
			for (const lancamento of this.lancamentos) {
				if (lancamento.tipo === "receita") {
					this.totalizadorDoMes.saldo += lancamento.valor
					this.totalizadorDoMes.receitas += lancamento.valor
				}
				if (lancamento.tipo === "despesa") {
					this.totalizadorDoMes.saldo -= lancamento.valor
					this.totalizadorDoMes.despesas += lancamento.valor
				}
			}
			this.totalizadorDoMes.distribuicaoDeDespesas = distribuirDespesas(this.lancamentos, this.totalizadorDoMes.despesas)
			const estaNegativo = this.totalizadorDoMes.saldo < 0
			if (estaNegativo) {
				this.totalizadorDoMes.juros = calcularJuros(this.totalizadorDoMes.saldo)
				this.totalizadorDoMes.saldo = arredondar(this.totalizadorDoMes.saldo + this.totalizadorDoMes.juros)
			} else {
				this.totalizadorDoMes.rendimentos = calcularRendimentos(this.totalizadorDoMes.saldo)
				this.totalizadorDoMes.saldo = arredondar(this.totalizadorDoMes.saldo + this.totalizadorDoMes.rendimentos)
			}
		}
	}

	function arredondar(valor) {
		return Math.round(valor * 100) / 100
	}

	function calcularJuros(valor) {
		const juros = arredondar(valor * 0.1)
		return juros
	}

	function calcularRendimentos(valor) {
		const rendimentos = arredondar(valor * 0.005);
		return rendimentos;
	}

	function distribuirDespesas(lancamentos, total) {
		const distribuicaoDeDespesas = []
		for (lancamento of lancamentos) {
			if (lancamento.tipo === "despesa") {
				const percentual = arredondar((lancamento.valor / total) * 100)
				distribuicaoDeDespesas.push({ categoria: lancamento.categoria, percentual })
			}
		}
		return distribuicaoDeDespesas
	}


	const saldoInicial = 0
	const janeiro = new Mes("janeiro", saldoInicial)

	janeiro.adicionarLancamento(new Lancamento("Salário", "receita", 3000));
	janeiro.adicionarLancamento(new Lancamento("Aluguel", "despesa", 1000));
	janeiro.adicionarLancamento(new Lancamento("Conta de Luz", "despesa", 200));
	janeiro.adicionarLancamento(new Lancamento("Conta de Água", "despesa", 100));
	janeiro.adicionarLancamento(new Lancamento("Internet", "despesa", 100));
	janeiro.adicionarLancamento(new Lancamento("Transporte", "despesa", 300));
	janeiro.adicionarLancamento(new Lancamento("Lazer", "despesa", 300));
	janeiro.adicionarLancamento(new Lancamento("Alimentação", "despesa", 500));
	janeiro.adicionarLancamento(new Lancamento("Condomínio", "despesa", 300));
	janeiro.adicionarLancamento(new Lancamento("Farmácia", "despesa", 100));

	janeiro.calcularSaldo();
	console.log(janeiro);

	const fevereiro = new Mes("fevereiro", janeiro.totalizadorDoMes.saldo);

	fevereiro.adicionarLancamento(new Lancamento("Salário", "receita", 3000));
	fevereiro.adicionarLancamento(new Lancamento("Aluguel", "despesa", 1200));
	fevereiro.adicionarLancamento(new Lancamento("Conta de Luz", "despesa", 250));
	fevereiro.adicionarLancamento(new Lancamento("Conta de Água", "despesa", 100));
	fevereiro.adicionarLancamento(new Lancamento("Internet", "despesa", 100));
	fevereiro.adicionarLancamento(new Lancamento("Transporte", "despesa", 500));
	fevereiro.adicionarLancamento(new Lancamento("Alimentação", "despesa", 1000));
	fevereiro.adicionarLancamento(new Lancamento("Condomínio", "despesa", 400));
	fevereiro.calcularSaldo();
	console.log(fevereiro);

	const marco = new Mes("Marco", fevereiro.totalizadorDoMes.saldo)

	marco.adicionarLancamento(new Lancamento("Salário", "receita", 4000));
	marco.adicionarLancamento(new Lancamento("Aluguel", "despesa", 1200));
	marco.adicionarLancamento(new Lancamento("Conta de Luz", "despesa", 200));
	marco.adicionarLancamento(new Lancamento("Conta de Água", "despesa", 100));
	marco.adicionarLancamento(new Lancamento("Internet", "despesa", 200));
	marco.adicionarLancamento(new Lancamento("Transporte", "despesa", 500));
	marco.adicionarLancamento(new Lancamento("Lazer", "despesa", 800));
	marco.adicionarLancamento(new Lancamento("Alimentação", "despesa", 1000));
	marco.adicionarLancamento(new Lancamento("Condomínio", "despesa", 400));
	marco.calcularSaldo();
	console.log(marco);

	//const acumuladoAno = marco.totalizadorDoMes.saldo
	//console.log("ano")
	//console.log(acumuladoAno)
	//teste 
	console.log(janeiro.totalizadorDoMes.saldo === 100.5);
	console.log(fevereiro.totalizadorDoMes.saldo === -494.45);
	console.log(marco.totalizadorDoMes.saldo === -983.89)
</script>

</html>